#!/bin/sh

source script.lib.sh


PackageBuildDependencies()
{
	printf '
autoconf
automake 
libtool 
';
}


PackageRuntimeDependencies()
{
	return 0;
}


PackageWarnings()
{
	printf 'at least up until v1.5.0, the meson build is "broken" (it tries to link with libintl if it sees libintl.h in the system, which we do not want and will make the package elfutils fail to build) and using "make install" seems to do nothing. No files are copied to DESTDIR. Currently we are using make and manually copying the the files.';
}


PackageBuild()
{
	local buildDir="$1";
	local prefix="$2";
	local destDir="$3";
	#local npp="$4";
	local dirBin="$5";
	
	local package='argp-standalone';

	local sourceDir;
	sourceDir=$(./latest.sh \
		--host='github-tag' \
		--package="${package}/${package}" \
		-b="$buildDir"
		);

	if [ $? -ne 0  ] || [ -z "$sourceDir" ]; then
		Die "unable to retrieve the latest version tar";
	fi

	(
		DieIfFails cd "$sourceDir";
		DieIfFails autoreconf -vif;
	);

	if [ $? -ne 0  ]; then
		Die "autoreconf failed!";
	fi
	
	DieIfFails ./make.sh \
		-b="$buildDir" \
		-s="$sourceDir" \
		--configure-options="\
			--prefix=$prefix \
		" \
		--dest-dir="$destDir" \
		--install-options="install-strip";

	# it seems make install does nothing. So we do it outselves
	DieIfFails install -D -m644 "${sourceDir}/argp.h" "${destDir}${prefix}/include/argp.h";
	DieIfFails install -D -m755 "${buildDir}/obj/libargp.a" "${destDir}${prefix}/lib/libargp.a";
}
